namespace = spyOpportunity

### IF FAIL OR DECLINE OR SUCCEED, PUT THEM BACK INTO PROGRESS TRACKER ###
country_event = {
	id = spyOpportunity.0
	hide_window = yes
	is_triggered_only = yes 
	
	immediate = {
		if = {
			limit = {
				has_country_flag = betaF_Opportunity
			}
			remove_country_flag = betaF_Opportunity
			remove_country_flag = betaF_OpportunityOngoing
			country_event = { id = progressTrackerB.3 }
		}
		else = {
			remove_country_flag = alphaF_OpportunityOngoing
			country_event = { id = progressTrackerA.3 }
		}
	}
} 
### GIVE OPPORTUNITY FLAGS, ROLL FOR EVENT ###
country_event = {
	id = spyOpportunity.1
	hide_window = yes
	is_triggered_only = yes 
	
	immediate = {
		set_timed_country_flag = { flag = opportunityLock days = 3650 }
		save_event_target_as = spyOpportunityAttacker
		if = {
			limit = {
				has_country_flag = betaF_Opportunity
			}
			event_target:betaNetworkTarget_temp = { save_event_target_as = spyOpportunityTarget }
			set_country_flag = betaF_OpportunityOngoing
		}
		else = {
			event_target:alphaNetworkTarget_temp = { save_event_target_as = spyOpportunityTarget }
			set_country_flag = alphaF_OpportunityOngoing
		}

		random_list = {
			50 = { # DEFECTING SCIENTIST
				modifier = {
					factor = 0
					or = {
						event_target:spyOpportunityTarget = { 
							is_ai = no 
						}
						has_country_flag = OppdefectingScientistCooldown
					}
				}
				set_timed_country_flag = {
					flag = OppdefectingScientistCooldown
					days = 3650
				}
				country_event = { id = studyTech_Opportunity.3 }
			}
			50 = { # INFECTED AGENTS
				modifier = {
					factor = 0
					or = {
						has_country_flag = OppinfectedAgents
						event_target:alphaNetworkTarget_temp = {
							is_at_war_with = event_target:spyOpportunityAttacker
						}
						event_target:alphaNetworkTarget_temp = {
							nor = {
								has_technology = tech_genome_mapping
								has_technology = tech_vitality_boosters
								has_technology = tech_frontier_hospital
								has_technology = tech_alien_life_studies
								has_technology = tech_society_3
								has_technology = tech_society_2
								has_technology = tech_society_1
							}
						}
					}
				}
				set_timed_country_flag = {
					flag = OppinfectedAgents
					days = 3650
				}
				country_event = { id = studyTech_Opportunity.1 }
			}
			10 = {
				country_event = {
					id = spyOpportunity.0
				}
			}
		}
	}
}
