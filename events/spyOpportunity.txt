namespace = spyOpportunity

### IF FAIL OR DECLINE OR SUCCEED, PUT THEM BACK INTO PROGRESS TRACKER ###
country_event = {
	id = spyOpportunity.0
	hide_window = yes
	is_triggered_only = yes 
	
	immediate = {
		if = {
			limit = {
				has_country_flag = betaF_Opportunity
			}
			remove_country_flag = betaF_Opportunity
			remove_country_flag = betaF_OpportunityOngoing
			country_event = { id = progressTrackerB.3 }
		}
		else = {
			remove_country_flag = alphaF_OpportunityOngoing
			country_event = { id = progressTrackerA.3 }
		}
	}
}
### GIVE OPPORTUNITY FLAGS, ROLL FOR EVENT ###
country_event = {
	id = spyOpportunity.1
	hide_window = yes
	is_triggered_only = yes 
	
	immediate = {
		set_timed_country_flag = { flag = opportunityLock days = 3650 }
		save_event_target_as = spyOpportunityAttacker
		if = {
			limit = {
				has_country_flag = betaF_Opportunity
			}
			event_target:betaNetworkTarget_temp = { save_event_target_as = spyOpportunityTarget }
			set_country_flag = betaF_OpportunityOngoing
		}
		else = {
			event_target:alphaNetworkTarget_temp = { save_event_target_as = spyOpportunityTarget }
			set_country_flag = alphaF_OpportunityOngoing
		}

		random_list = {
			50 = { # DEFECTING SCIENTIST
				modifier = {
					factor = 0
					or = {
						event_target:spyOpportunityTarget = { 
							is_ai = no 
						}
						has_country_flag = OppdefectingScientistCooldown
					}
				}
				set_timed_country_flag = {
					flag = OppdefectingScientistCooldown
					days = 3650
				}
				country_event = { id = spyOpportunity.2 }
			}
			50 = { # INFECTED AGENTS
				modifier = {
					factor = 0
					has_country_flag = OppinfectedAgents
				}
				set_timed_country_flag = {
					flag = OppinfectedAgents
					days = 3650
				}
				country_event = { id = spyOpportunity.2 }
			}
			10 = {
				country_event = {
					id = spyOpportunity.0
				}
			}
		}
	}
}









### INDUSTRIAL ESPIONAGE - DEFECTING SCIENTIST - INITAL EVENT ###
country_event = {
	id = spyOpportunity.2
	title = "spyOpportunity.2.name"
	desc = "spyOpportunity.2.desc"
	is_triggered_only = yes 
	picture = GFX_evt_smugglers_in_bar
	show_sound = event_default

	immediate = {
		event_target:spyOpportunityTarget = {
			random_owned_leader = {
				limit = {
					leader_class = SCIENTIST
				}
				save_event_target_as = defectingScientist
			}
			species = { save_event_target_as = defecting_species }
		}
	}

	option = {
		name = spyOpportunity.2.a #RAID RESEARCH LAB THEY'RE STATIONED AT
		hidden_effect = {
			random_list = {
				60 = { #complication
					country_event = { id = spyOpportunity.3 days = @opportunityGapTime random = @opportunityGapTimeRandom }
				}
				40 = { #auto win
					country_event = { id = spyOpportunity.7 days = @opportunityGapTime random = @opportunityGapTimeRandom }
				}
			}
		}
	}

	option = {
		name = spyOpportunity.2.b #COVERTLY INFILTRATE THE RESEARCH LAB
		hidden_effect = {
			random_list = {
				60 = { #complication
					country_event = { id = spyOpportunity.18 days = @opportunityGapTime random = @opportunityGapTimeRandom }
				}
				40 = { #auto win
					country_event = { id = spyOpportunity.7 days = @opportunityGapTime random = @opportunityGapTimeRandom }
				}
			}
		}
	}

	option = {
		name = spyOpportunity.2.c #CANCEL, CONTINUE OP AS NORMAL
		hidden_effect = {
			country_event = { id = spyOpportunity.0 }
			#PUT THEM BACK ONTO INDUSTRIAL ESP
		}
	}
}

#### RAID THE LAB CHAIN ####
	## TEAM BACKED INTO CORNER, ACTIVATE KILL SWITCH? ##
	country_event = {  
		id = spyOpportunity.3
		title = "spyOpportunity.3.name"
		desc = "spyOpportunity.3.desc"
		is_triggered_only = yes 
		picture = GFX_evt_guardians
		show_sound = event_ground_battle

		option = { #KILL SWITCH
			name = spyOpportunity.3.a
			country_event = { id = spyOpportunity.4 days = @opportunityGapTime random = @opportunityGapTimeRandom } #TEAM KILLED, MISSION FAILED
		}
		option = { #WAIT
			name = spyOpportunity.3.b
			hidden_effect = {
				random_list = {
					50 = {
						country_event = { id = spyOpportunity.5 days = @opportunityGapTime random = @opportunityGapTimeRandom } #TEAM CAPTURED, FAILED
					}
					50 = {
						country_event = { id = spyOpportunity.6 days = @opportunityGapTime random = @opportunityGapTimeRandom } #TEAM SURVIVE, MISSION WON
					}
				}
			}
		}
	}

	## KILL SUCCEED, MISSION FAILED ##
	country_event = {  
		id = spyOpportunity.4
		title = "spyOpportunity.4.name"
		desc = "spyOpportunity.4.desc"
		is_triggered_only = yes 
		picture = GFX_evt_derelict_interior
		show_sound = event_life_support_fail

		option = { #ok
			name = spyOpportunity.4.a
			hidden_effect = {
				country_event = { id = spyOpportunity.0 }
				country_event = { id = spyOpportunity.100 }
			}
		}
	}

	## WAIT, TEAM CAPTURED, MISSION FAILED ##
	country_event = {  
		id = spyOpportunity.5
		title = "spyOpportunity.5.name"
		desc = "spyOpportunity.5.desc"
		is_triggered_only = yes 
		picture = GFX_evt_surrender
		show_sound = event_radio_chatter

		option = { #ok
			name = spyOpportunity.5.a
			hidden_effect = {
				country_event = {
					id = spyOpportunity.0
				}
			}
		}
	}

	## WAIT, TEAM SURVIVE, MISSION SUCCEED ##
	country_event = {  
		id = spyOpportunity.6
		title = "spyOpportunity.6.name"
		desc = "spyOpportunity.6.desc"
		is_triggered_only = yes 
		picture = mem_victory
		show_sound = event_radio_chatter

		option = { #ok
			name = spyOpportunity.6.a
			hidden_effect = {
				country_event = { id = spyOpportunity.0 }
				country_event = { id = spyOpportunity.100 } #GET THE SCIENTIST 
			}
		}
	}

	## MISSION SUCCEED ##
	country_event = {  
		id = spyOpportunity.7
		title = "spyOpportunity.7.name"
		desc = "spyOpportunity.7.desc"
		is_triggered_only = yes 
		picture = mem_victory
		show_sound = event_radio_chatter

		option = { #ok
			name = spyOpportunity.7.a
			hidden_effect = {
				country_event = { id = spyOpportunity.100 }
				country_event = { id = spyOpportunity.0 }
			}
		}
	}




#### INFILTRATE THE LAB CHAIN ####
### PERIMETRE PATROLS BETTER THAN EXPECTED ###
	country_event = {  
		id = spyOpportunity.18
		title = "spyOpportunity.18.name"
		desc = "spyOpportunity.18.desc"
		is_triggered_only = yes 
		picture = GFX_evt_archaeology_camp
		show_sound = event_default

		option = { #SECONDARY ENTRANCE
			name = spyOpportunity.18.a
			hidden_effect = {
				random_list = {
					50 = { #SUCCEED
						country_event = {
							id = spyOpportunity.9 days = @opportunityGapTime random = @opportunityGapTimeRandom
						}
					}
					50 = { #COMPLICATION
						country_event = {
							id = spyOpportunity.8 days = @opportunityGapTime random = @opportunityGapTimeRandom
						}
					}
				}
			}
		}
		option = { #AMBUSH PATROL
			name = spyOpportunity.18.b
			hidden_effect = {
				random_list = {
					50 = { #SUCCEED
						country_event = {
							id = spyOpportunity.9 days = @opportunityGapTime random = @opportunityGapTimeRandom
						}
					}
					50 = { #COMPLICATION
						country_event = {
							id = spyOpportunity.19 days = @opportunityGapTime random = @opportunityGapTimeRandom
						}
					}
				}
			}
		}
	}
### SECOND ENTRANCE ###
### LASER GRID IN VENT ###
	country_event = {  
		id = spyOpportunity.8
		title = "spyOpportunity.8.name"
		desc = "spyOpportunity.8.desc"
		is_triggered_only = yes 
		picture = GFX_evt_laser_grid
		show_sound = event_default

		option = {
			name = spyOpportunity.8.a
			hidden_effect = {
				random_list = {
					50 = { #SUCCEED
						country_event = {
							id = spyOpportunity.9 days = @opportunityGapTime random = @opportunityGapTimeRandom
						}
					}
					50 = { #FAIL
						country_event = {
							id = spyOpportunity.10 days = @opportunityGapTime random = @opportunityGapTimeRandom
						}
					}
				}
			}
		}
	}


	#AMBUSH PATROLS COMPLICATION
	country_event = {  
		id = spyOpportunity.19
		title = "spyOpportunity.19.name"
		desc = "spyOpportunity.19.desc"
		is_triggered_only = yes 
		picture = GFX_evt_archaeology_camp
		show_sound = event_radio_chatter

		option = { #TAKE UNIFORMS
			name = spyOpportunity.19.a
			hidden_effect = {
				random_list = {
					50 = { #succeed
						country_event = { id = spyOpportunity.9 days = @opportunityGapTime random = @opportunityGapTimeRandom }
					}
					50 = { #fail
						country_event = { id = spyOpportunity.10 days = @opportunityGapTime random = @opportunityGapTimeRandom }
					}
				}
			}
		}
		option = { #CONTINUE AS NORMAL
			name = spyOpportunity.19.b
			hidden_effect = {
				random_list = {
					50 = { #succeed
						country_event = { id = spyOpportunity.9 days = @opportunityGapTime random = @opportunityGapTimeRandom }
					}
					50 = { #fail
						country_event = { id = spyOpportunity.10 days = @opportunityGapTime random = @opportunityGapTimeRandom }
					}
				}
			}
		}
	}



	## MISSION SUCCEED ##
	country_event = {  
		id = spyOpportunity.9
		title = "spyOpportunity.9.name"
		desc = "spyOpportunity.9.desc"
		is_triggered_only = yes 
		picture = GFX_evt_landing_ship
		show_sound = event_radio_chatter

		option = { #ok
			name = spyOpportunity.9.a
			hidden_effect = {
				country_event = { id = spyOpportunity.100 }
				country_event = { id = spyOpportunity.0 }
			}
		}
	}
	## MISSION FAILED ##
	country_event = {  
		id = spyOpportunity.10
		title = "spyOpportunity.10.name"
		desc = "spyOpportunity.10.desc"
		is_triggered_only = yes 
		picture = GFX_evt_derelict_interior
		show_sound = event_life_support_fail

		option = { #ok
			name = spyOpportunity.10.a
			hidden_effect = {
				country_event = { id = spyOpportunity.0 }
			}
		}
	}



#### GET THE SCIENTIST ####
country_event = {  
	id = spyOpportunity.100
	is_triggered_only = yes 
	hide_window = yes

	immediate = {
		event_target:spyOpportunityTarget = {
			random_owned_leader = {
				limit = {
					leader_class = SCIENTIST
				}
				save_event_target_as = defectingScientist
			}
			species = { save_event_target_as = defecting_species }
		}

		event_target:defectingScientist = {
			kill_leader = { show_notification = no }
		}
		
		create_leader = {
			class = scientist
			species = event_target:defecting_species
			skill = 3
			traits = {
				trait = leader_trait_spark_of_genius
				trait = leader_trait_paranoid
			}
			leader_age_min = 25
			leader_age_max = 45
			name = random
		}
	}
}
